# Reproducible Research: Peer Assessment 1

```{r "Initialization"}
rm(list=ls()) # clean up environment to reduce side effects
# no need to do anything about echo since the default is TRUE
library(lubridate)
library(data.table)
library(ggplot2)

```


## Loading and preprocessing the data
```{r "Loading"}
zipfile <- "activity.zip"
activityFileName <- "activity.csv"

activities <- read.csv(unz(zipfile, activityFileName))
activities$date <- ymd(activities$date)

convertIntervalToHourMinutes <- function(interval){
    hoursOnly <- interval %/% 100
    minutesOnly <- interval - (hoursOnly * 100)
    
    return(hm(paste(hoursOnly, minutesOnly, sep=":")))
}

dateTimeInterval <- activities$date + convertIntervalToHourMinutes(activities$interval)
activities <- cbind(activities, dateTimeInterval)
summary(activities)

activities.dt <- as.data.table(activities)

```

## What is mean total number of steps taken per day?
```{r "steps per day"}

totalStepsPerDay <- activities.dt[,list(totalSteps=sum(steps, na.rm=TRUE)), by=date]

# TODO:
    # add title and proper axis titles
    # maybe convert totals to table?
g <- ggplot(totalStepsPerDay, aes(x=totalSteps))
g <- g + geom_histogram(binwidth=2000)
g + geom_rug() 

# mean and median total steps per day
totals <- totalStepsPerDay[,list(
    mean=mean(totalSteps), 
    median=median(totalSteps))]
```

- The mean step per day is **`r totals$mean`**
- The median step per day is **`r totals$median`**

## What is the average daily activity pattern?

```{r "Average daily activity"}

avgStepsPerInterval <- activities.dt[,list(averageSteps=mean(steps,na.rm=TRUE)), by=interval]

g <- ggplot(avgStepsPerInterval, aes(interval, averageSteps))
g + geom_line()


# interval with the maximum average number of steps
maxAverageNumberOfSteps <- max(avgStepsPerInterval$averageSteps)
result <- avgStepsPerInterval[averageSteps == maxAverageNumberOfSteps,interval]
```
- The interval with the biggest average number of step is **`r result`**


## Imputing missing values
The number of missing steps in the dataset is : **`r nrow(activities.dt[is.na(steps)])`**

### Filling missing values
Strategy being used:
Take the mean step of each interval to replace the missing values.
```{r "Filling missing values"}
nomissing.dt <- activities.dt
nomissing.dt[is.na(steps), steps := as.integer(avgStepsPerInterval[avgStepsPerInterval$interval == interval,averageSteps])]
```

```{r "Steps per day no NA"}

totalStepsPerDay.noNA <- nomissing.dt[,list(totalSteps=sum(steps, na.rm=TRUE)), by=date]

# TODO:
    # add title and proper axis titles
    # maybe convert totals to table?
g <- ggplot(totalStepsPerDay.noNA, aes(x=totalSteps))
g <- g + geom_histogram(binwidth=2000)
g + geom_rug() 

# mean and median total steps per day
totals.noNA <- totalStepsPerDay.noNA[,list(
    mean=mean(totalSteps), 
    median=median(totalSteps))]
```

- The mean step per day without NA is `r totals.noNA$mean`
- The median step per day without NA is `r totals.noNA$median`

## Are there differences in activity patterns between weekdays and weekends?
```{r "prepare data.table"}
getWeekDayType <- function(date){
    ifelse(wday %in% c(1,7),"weekday", "weekend")
}

nomissing.dt[, weekDayType := as.factor(getWeekDayType(date))]
a$weekDayType <- as.factor(a$weekDayType)

nomissing.avgSteps<- nomissing.dt[,list(averageSteps=mean(steps,na.rm=TRUE)), by=list(weekDayType,interval)]

g <- ggplot(nomissing.avgSteps, aes(interval, averageSteps))
g <- g + geom_line()
g + facet_grid(weekDayType ~ .)
```

